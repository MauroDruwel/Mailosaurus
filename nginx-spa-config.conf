# Nginx configuration snippet for Mailosaurus SPA routing
# Add this to your nginx site configuration to handle React Router routes

location /admin {
    # Handle the React app's built files
    try_files $uri $uri/ @admin_fallback;
}

# Fallback for React Router - serve index.html for unmatched routes
location @admin_fallback {
    # Check if it's an API request
    if ($uri ~ ^/admin/(login|logout|mail|dns|ssl|web|system|mfa|munin)/) {
        # These are API endpoints, let them pass through to the backend
        proxy_pass http://127.0.0.1:10222;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        break;
    }
    
    # For non-API requests, serve the React app index.html
    try_files /admin/index.html =404;
}

# Optional: Add caching for static assets
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
    expires 1y;
    add_header Cache-Control "public, immutable";
}

# Example of how to integrate this into your main nginx config:
#
# server {
#     listen 80;
#     server_name your-domain.com;
#     
#     # Root directory where your static files are served
#     root /var/www/html;
#     
#     # Main Mail-in-a-Box admin interface (backend API)
#     location /admin/ {
#         proxy_pass http://127.0.0.1:10222/;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#     }
#     
#     # Add the SPA routing configuration here
#     # ... (insert the configuration above)
# }